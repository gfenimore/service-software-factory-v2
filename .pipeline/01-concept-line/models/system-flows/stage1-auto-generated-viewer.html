<!DOCTYPE html>
<html>
<head>
    <title>Stage 1: Requirements Capture - Sequence Diagram</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            margin: 0; 
            background: #f5f5f5; 
        }
        .container { 
            max-width: 1600px; 
            margin: 0 auto; 
            padding: 20px; 
        }
        .header {
            background: white;
            padding: 30px;
            border-radius: 8px;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .header h1 {
            margin: 0 0 15px 0;
            color: #2c3e50;
        }
        .header p {
            margin: 0;
            color: #666;
            font-size: 16px;
        }
        .content {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        .mermaid {
            text-align: center;
            background: white;
            padding: 20px;
            border-radius: 6px;
        }
        .key-points {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 6px;
            border-left: 4px solid #1976d2;
            margin-bottom: 30px;
        }
        .key-points h3 {
            color: #1976d2;
            margin-top: 0;
        }
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .metric-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
        }
        .metric-value {
            font-size: 32px;
            font-weight: bold;
            color: #4caf50;
            margin-bottom: 5px;
        }
        .metric-label {
            color: #666;
            font-size: 14px;
        }
        .automation-breakdown {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }
        .automation-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 15px;
        }
        .automated-list, .manual-list {
            background: white;
            padding: 15px;
            border-radius: 6px;
            border: 2px solid #e0e0e0;
        }
        .automated-list {
            border-color: #4caf50;
        }
        .manual-list {
            border-color: #ff9800;
        }
        .automated-list h4 {
            color: #4caf50;
            margin: 0 0 10px 0;
        }
        .manual-list h4 {
            color: #ff9800;
            margin: 0 0 10px 0;
        }
        .automated-list ul, .manual-list ul {
            margin: 0;
            padding-left: 20px;
        }
        .automated-list li, .manual-list li {
            margin-bottom: 5px;
        }
        .artifacts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .artifact-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
        }
        .artifact-header {
            background: #f5f5f5;
            padding: 15px;
            border-bottom: 2px solid #e0e0e0;
        }
        .artifact-header h4 {
            margin: 0;
            color: #333;
        }
        .artifact-content {
            padding: 15px;
        }
        .artifact-list {
            margin: 0;
            padding-left: 20px;
        }
        .artifact-list li {
            margin-bottom: 8px;
            color: #555;
        }
        .generated-notice {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 20px;
            font-size: 14px;
            color: #856404;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="generated-notice">
            🤖 This viewer was auto-generated from sequence diagram markdown. Last updated: 2025-09-01T22:00:40.937Z
        </div>
        
        <div class="header">
            <h1>🔄 Stage 1: Requirements Capture - Sequence Diagram</h1>
            <p>The Automated Requirements Processing Pipeline</p>
        </div>

        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-value">90%</div>
                <div class="metric-label">Automation Level</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">5-10 min</div>
                <div class="metric-label">Processing Time</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">5</div>
                <div class="metric-label">Output Artifacts</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">100%</div>
                <div class="metric-label">Consistency</div>
            </div>
        </div>

        <div class="key-points">
            <h3>🎯 Stage Overview</h3>
            <p>## Sequence Diagram</p>
        </div>

        <div class="content">
            <div class="mermaid">
sequenceDiagram
  participant PO as Product Owner
  participant UI as Concept Line UI
  participant Orch as Pipeline Orchestrator  
  participant BUSM as BUSM File
  participant RuleGen as Rule Generator
  participant CompGen as Component Generator
  participant Template as Template Manager
  participant Output as Stage 1 Outputs

  Note over PO,Output: STAGE 1 SERVICE SOFTWARE FACTORY Template-Based Requirements Capture

  PO->>UI: Access Concept Line UI Form
  activate UI
  UI->>PO: Display scope definition form
  
  PO->>UI: Define service domain and customizations
  Note right of UI: Domain: Pest Control<br/>Client: ABC Pest Control<br/>Target: Production
  UI->>UI: Load base system (17 entities)
  UI->>PO: Show domain customization options
  
  PO->>UI: Configure domain extensions
  Note right of UI: Base: Universal Service Model<br/>Extensions: Pest Control fields<br/>Rules: Domain-specific
  UI->>BUSM: Load base entity model
  activate BUSM
  BUSM-->>UI: Return entity structures
  Note left of BUSM: ACCOUNT: 8 fields<br/>CONTACT: 7 fields<br/>SERVICE_LOCATION: 14 fields<br/>WORK_ORDER: 10 fields
  deactivate BUSM
  
  UI->>CompGen: Generate base system views
  activate CompGen
  CompGen->>CompGen: Create Master View (3-column) and Analysis View (spreadsheet)
  Note over CompGen: Master: Account Hub | Service Locations | Work Orders<br/>Analysis: List-based with filtering/sorting
  CompGen-->>UI: Return view configurations
  Note left of CompGen: Master View: 3-column layout<br/>Analysis View: 4 tabs (Accounts, Locations, Orders, Revenue)
  deactivate CompGen
  
  UI->>RuleGen: Auto-generate business rules
  activate RuleGen
  RuleGen->>BUSM: Read entity field types and constraints
  RuleGen->>RuleGen: Apply 3-layer inheritance
  Note over RuleGen: Layer 1: Universal rules (17 entities)<br/>Layer 2: Pest Control domain rules<br/>Layer 3: Client customizations
  RuleGen-->>UI: Return generated rules summary
  Note left of RuleGen: Universal + Domain + Custom rules ready
  deactivate RuleGen
  
  UI->>PO: Show base system configuration preview
  Note over UI,PO: Base: 17 entities, 2 views<br/>Domain: Pest Control extensions<br/>Rules: Universal + Domain + Custom
  
  alt Layer 3 Customizations
    PO->>UI: Add client customizations via UI input
    UI->>UI: Merge custom rules with generated rules
    UI->>UI: Auto-resolve conflicts with user override option
  end
  
  PO->>UI: Confirm final configuration
  
  alt Save as Template
    PO->>UI: Save as template
    UI->>UI: Auto-generate template name
    Note right of UI: Template: PestControl_20250901
    UI->>Template: Store template configuration
    activate Template
    Template-->>UI: Template saved for future use
    deactivate Template
  end
  
  PO->>UI: Run Concept Line Pipeline
  UI->>Orch: Execute Stage 1 with configuration
  activate Orch
  
  Orch->>Output: Write scope-definition.json
  Orch->>Output: Write selected-entities.json
  Orch->>Output: Write component-specifications.json
  Orch->>Output: Write business-rules.json
  Orch->>Output: Write template-config.json if saved
  
  Orch->>Orch: Validate format and completeness
  Note over Orch: Check JSON structure<br/>Verify required fields<br/>Confirm artifact completeness
  
  Orch->>PO: Stage 1 Complete
  Note over Orch,PO: Service: Pest Control<br/>Entities: 4 selected<br/>Components: 7 generated<br/>Rules: 79 ready<br/>Template: Saved<br/>Status: Ready for Stage 2
  deactivate UI
  deactivate Orch
  
  Note over PO,Output: Stage 1 Complete - Service Software Factory Template Created and Ready
            </div>
        </div>

        <div class="artifacts-grid">
            <div class="artifact-card">
                <div class="artifact-header">
                    <h4>📥 Input Artifacts</h4>
                </div>
                <div class="artifact-content">
                    <ul class="artifact-list">
                        <li>`.pipeline/00-requirements/models/BUSM.mmd` - Business model in Mermaid format</li>
                        <li>`.product-specs/.../master-view-feature.md` - Feature specification</li>
                        <li>Business rules (via UI or defaults)</li>
                    </ul>
                </div>
            </div>
            <div class="artifact-card">
                <div class="artifact-header">
                    <h4>📤 Output Artifacts</h4>
                </div>
                <div class="artifact-content">
                    <ul class="artifact-list">
                        <li>`stage1/busm-subset.mmd` - Filtered BUSM with only needed entities</li>
                        <li>`stage1/feature-spec.md` - Copy of feature specification</li>
                        <li>`stage1/business-rules.json` - Structured business rules including:</li>
                        <li>Rule definitions</li>
                        <li>Types and priorities</li>
                        <li>Component associations</li>
                        <li>Visual indicators</li>
                    </ul>
                </div>
            </div>
            <div class="artifact-card">
                <div class="artifact-header">
                    <h4>⚙️ Tools Involved</h4>
                </div>
                <div class="artifact-content">
                    <ul class="artifact-list">
                        <li>Rule Collection UI</li>
                        <li>Pipeline Orchestrator</li>
                        <li>BUSM Mermaid Parser</li>
                        <li>Gap Logger</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="automation-breakdown">
            <h3>🤖 Automation Breakdown</h3>
            <div class="automation-section">
                <div class="automated-list">
                    <h4>✅ Automated (90%)</h4>
                    <ul>
                        <li>BUSM Mermaid parsing</li>
                        <li>Entity extraction from specs</li>
                        <li>BUSM subset filtering</li>
                        <li>Business rule ID generation</li>
                        <li>Rule validation and formatting</li>
                        <li>Gap identification</li>
                        <li>Artifact generation</li>
                        <li>File writing and organization</li>
                        <li>Progress logging</li>
                        <li>Error handling</li>
                    </ul>
                </div>
                <div class="manual-list">
                    <h4>⚡ Manual (10%)</h4>
                    <ul>
                        <li>Creating BUSM diagram (one-time)</li>
                        <li>Writing feature spec (one-time)</li>
                        <li>Defining business rules (optional, UI-assisted)</li>
                        <li>Running pipeline command</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            sequence: {
                useMaxWidth: true,
                showSequenceNumbers: true,
                wrap: true
            }
        });
    </script>
</body>
</html>