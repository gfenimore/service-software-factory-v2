<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Single Entity Field Configurator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 24px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 8px;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .entity-selector {
            display: flex;
            gap: 12px;
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
        }

        .entity-btn {
            padding: 10px 24px;
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .entity-btn:hover {
            background: #f8f9fa;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .entity-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .context-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            background: #fff;
            border-bottom: 1px solid #e9ecef;
        }

        .context-selector {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .context-selector select {
            padding: 8px 12px;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            font-size: 14px;
            background: white;
            cursor: pointer;
        }

        .context-actions {
            display: flex;
            gap: 8px;
        }

        .btn-small {
            padding: 8px 16px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .btn-small:hover {
            background: #5a67d8;
            transform: translateY(-1px);
        }

        .btn-small.secondary {
            background: #48bb78;
        }

        .btn-small.secondary:hover {
            background: #38a169;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 0;
            min-height: 500px;
        }

        .fields-panel {
            padding: 20px;
            background: #f8f9fa;
            border-right: 2px solid #e9ecef;
        }

        .preview-panel {
            padding: 20px;
            background: white;
        }

        .panel-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 16px;
            color: #2d3748;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .panel-title::before {
            content: '';
            width: 4px;
            height: 20px;
            background: #667eea;
            border-radius: 2px;
        }

        .available-fields {
            background: white;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 16px;
            border: 2px dashed #dee2e6;
            min-height: 150px;
        }

        .field-item {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            padding: 10px 14px;
            margin-bottom: 8px;
            cursor: move;
            transition: all 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
            user-select: none;
        }

        .field-item:hover {
            border-color: #667eea;
            transform: translateX(4px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .field-item.dragging {
            opacity: 0.5;
            transform: rotate(2deg);
        }

        .field-item.drag-over {
            border-color: #48bb78;
            background: #f0fff4;
        }

        .field-name {
            font-weight: 500;
            color: #2d3748;
            font-size: 14px;
        }

        .field-type {
            font-size: 11px;
            color: #718096;
            background: #edf2f7;
            padding: 2px 8px;
            border-radius: 4px;
        }

        .preview-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            overflow: hidden;
        }

        .card-header {
            background: #f8f9fa;
            padding: 12px 16px;
            border-bottom: 1px solid #e9ecef;
            font-weight: 600;
            color: #2d3748;
        }

        .card-rows {
            padding: 12px;
        }

        .card-row {
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 12px;
            min-height: 60px;
            transition: all 0.2s;
        }

        .card-row.drag-over {
            background: #e6fffa;
            border-color: #48bb78;
        }

        .row-label {
            font-size: 12px;
            font-weight: 600;
            color: #718096;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .row-fields {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            min-height: 30px;
        }

        .preview-field {
            background: white;
            border: 1px solid #cbd5e0;
            border-radius: 4px;
            padding: 6px 10px;
            font-size: 13px;
            color: #2d3748;
            cursor: move;
            transition: all 0.2s;
        }

        .preview-field:hover {
            border-color: #667eea;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .preview-field.dragging {
            opacity: 0.5;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #a0aec0;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 12px;
        }

        .empty-state-text {
            font-size: 14px;
        }

        .footer-actions {
            padding: 20px;
            background: #f8f9fa;
            border-top: 2px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .btn-primary {
            padding: 12px 24px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary:hover {
            background: #5a67d8;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .status-message {
            padding: 8px 16px;
            background: #48bb78;
            color: white;
            border-radius: 6px;
            font-size: 13px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .status-message.show {
            opacity: 1;
        }

        .live-preview-panel {
            padding: 20px;
            background: linear-gradient(to bottom, #f7fafc, #edf2f7);
            border-left: 2px solid #e9ecef;
        }

        .live-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
            overflow: hidden;
            transition: transform 0.3s ease;
        }

        .live-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }

        .live-card-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 16px;
            font-weight: 600;
            font-size: 16px;
        }

        .live-card-body {
            padding: 16px;
        }

        .live-field-row {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid #e9ecef;
        }

        .live-field-row:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .live-field {
            flex: 1;
            min-width: 120px;
        }

        .live-field-label {
            font-size: 11px;
            font-weight: 600;
            color: #718096;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .live-field-value {
            font-size: 14px;
            color: #2d3748;
            font-weight: 500;
        }

        .live-field-value.status {
            display: inline-block;
            padding: 2px 8px;
            background: #48bb78;
            color: white;
            border-radius: 4px;
            font-size: 12px;
        }

        .live-field-value.priority {
            display: inline-block;
            padding: 2px 8px;
            background: #ed8936;
            color: white;
            border-radius: 4px;
            font-size: 12px;
        }

        .live-field-value.currency::before {
            content: '$';
        }

        .empty-preview {
            text-align: center;
            padding: 60px 20px;
            color: #a0aec0;
        }

        .empty-preview-icon {
            font-size: 64px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .sample-data-note {
            font-size: 11px;
            color: #a0aec0;
            text-align: center;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #e9ecef;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ Single Entity Field Configurator</h1>
            <p>Configure one entity at a time with precision control</p>
        </div>

        <div class="entity-selector">
            <button class="entity-btn active" data-entity="account">Account</button>
            <button class="entity-btn" data-entity="location">Service Location</button>
            <button class="entity-btn" data-entity="workorder">Work Order</button>
        </div>

        <div class="context-bar">
            <div class="context-selector">
                <label style="font-size: 14px; font-weight: 500; color: #4a5568;">Context:</label>
                <select id="contextSelect">
                    <option value="default">Default View</option>
                    <option value="compact">Compact Card</option>
                    <option value="detailed">Detailed View</option>
                    <option value="mobile">Mobile View</option>
                </select>
                <button class="btn-small secondary" onclick="saveContext()">Save Context</button>
            </div>
            <div class="context-actions">
                <button class="btn-small" onclick="addNewContext()">+ New Context</button>
                <button class="btn-small secondary" onclick="resetFields()">Reset</button>
            </div>
        </div>

        <div class="main-content">
            <div class="fields-panel">
                <div class="panel-title">Available Fields</div>
                <div class="available-fields" id="availableFields">
                    <!-- Fields will be populated here -->
                </div>
                <div style="font-size: 12px; color: #718096; margin-top: 8px;">
                    üí° Drag fields to the preview rows on the right
                </div>
            </div>

            <div class="preview-panel">
                <div class="panel-title">Configuration Builder</div>
                <div class="preview-card">
                    <div class="card-header" id="cardHeader">Account Card</div>
                    <div class="card-rows">
                        <div class="card-row" data-row="1">
                            <div class="row-label">Row 1 - Primary Information</div>
                            <div class="row-fields" id="row1Fields"></div>
                        </div>
                        <div class="card-row" data-row="2">
                            <div class="row-label">Row 2 - Secondary Details</div>
                            <div class="row-fields" id="row2Fields"></div>
                        </div>
                        <div class="card-row" data-row="3">
                            <div class="row-label">Row 3 - Additional Info</div>
                            <div class="row-fields" id="row3Fields"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="live-preview-panel">
                <div class="panel-title">Live Preview</div>
                <div id="livePreview">
                    <div class="empty-preview">
                        <div class="empty-preview-icon">üìã</div>
                        <div>Drag fields to see live preview</div>
                    </div>
                </div>
                <div class="sample-data-note">
                    üí° Showing sample data for preview
                </div>
            </div>
        </div>

        <div class="footer-actions">
            <div class="status-message" id="statusMessage">Configuration saved!</div>
            <button class="btn-primary" onclick="saveConfiguration()">Save Configuration</button>
        </div>
    </div>

    <script>
        // Entity field definitions
        const entityFields = {
            account: [
                { name: 'accountNumber', label: 'Account Number', type: 'text' },
                { name: 'accountName', label: 'Account Name', type: 'text' },
                { name: 'status', label: 'Status', type: 'status' },
                { name: 'balance', label: 'Balance', type: 'currency' },
                { name: 'creditLimit', label: 'Credit Limit', type: 'currency' },
                { name: 'contactName', label: 'Primary Contact', type: 'text' },
                { name: 'phone', label: 'Phone', type: 'phone' },
                { name: 'email', label: 'Email', type: 'email' },
                { name: 'lastPayment', label: 'Last Payment', type: 'date' },
                { name: 'accountType', label: 'Account Type', type: 'text' }
            ],
            location: [
                { name: 'locationId', label: 'Location ID', type: 'text' },
                { name: 'locationName', label: 'Location Name', type: 'text' },
                { name: 'address', label: 'Address', type: 'address' },
                { name: 'serviceType', label: 'Service Type', type: 'text' },
                { name: 'lastService', label: 'Last Service', type: 'date' },
                { name: 'nextService', label: 'Next Service', type: 'date' },
                { name: 'equipment', label: 'Equipment Count', type: 'number' },
                { name: 'accessNotes', label: 'Access Notes', type: 'text' },
                { name: 'contractStatus', label: 'Contract Status', type: 'status' },
                { name: 'priority', label: 'Priority', type: 'text' }
            ],
            workorder: [
                { name: 'workOrderId', label: 'Work Order #', type: 'text' },
                { name: 'description', label: 'Description', type: 'text' },
                { name: 'status', label: 'Status', type: 'status' },
                { name: 'priority', label: 'Priority', type: 'priority' },
                { name: 'assignedTo', label: 'Assigned To', type: 'text' },
                { name: 'scheduledDate', label: 'Scheduled Date', type: 'date' },
                { name: 'estimatedHours', label: 'Est. Hours', type: 'number' },
                { name: 'customerName', label: 'Customer', type: 'text' },
                { name: 'location', label: 'Location', type: 'text' },
                { name: 'notes', label: 'Notes', type: 'text' }
            ]
        };

        // Sample data for preview
        const sampleData = {
            account: {
                accountNumber: 'ACC-2024-1234',
                accountName: 'Acme Corporation',
                status: 'Active',
                balance: '12,450.00',
                creditLimit: '50,000.00',
                contactName: 'John Smith',
                phone: '(555) 123-4567',
                email: 'john@acme.com',
                lastPayment: '2024-01-15',
                accountType: 'Commercial'
            },
            location: {
                locationId: 'LOC-5678',
                locationName: 'Main Office Building',
                address: '123 Business Park Dr',
                serviceType: 'HVAC Maintenance',
                lastService: '2024-01-10',
                nextService: '2024-02-10',
                equipment: '24',
                accessNotes: 'Use service entrance',
                contractStatus: 'Active',
                priority: 'High'
            },
            workorder: {
                workOrderId: 'WO-9876',
                description: 'Quarterly HVAC Inspection',
                status: 'Scheduled',
                priority: 'Medium',
                assignedTo: 'Mike Johnson',
                scheduledDate: '2024-02-15',
                estimatedHours: '4.5',
                customerName: 'Acme Corporation',
                location: 'Main Office Building',
                notes: 'Check all filters and belts'
            }
        };

        // Current state
        let currentEntity = 'account';
        let currentContext = 'default';
        let configurations = {};

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadConfigurations();
            initializeEntityButtons();
            loadEntityFields(currentEntity);
            setupDragAndDrop();
            updateLivePreview();
        });

        function initializeEntityButtons() {
            document.querySelectorAll('.entity-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    // Save current configuration before switching
                    saveCurrentState();
                    
                    // Update active button
                    document.querySelectorAll('.entity-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    
                    // Switch entity
                    currentEntity = btn.dataset.entity;
                    loadEntityFields(currentEntity);
                    updateCardHeader();
                    loadSavedConfiguration();
                    updateLivePreview();
                });
            });
        }

        function loadEntityFields(entity) {
            const container = document.getElementById('availableFields');
            container.innerHTML = '';
            
            const fields = entityFields[entity] || [];
            fields.forEach(field => {
                const fieldEl = createFieldElement(field);
                container.appendChild(fieldEl);
            });
        }

        function createFieldElement(field) {
            const div = document.createElement('div');
            div.className = 'field-item';
            div.draggable = true;
            div.dataset.field = field.name;
            div.dataset.label = field.label;
            div.dataset.type = field.type;
            
            div.innerHTML = `
                <span class="field-name">${field.label}</span>
                <span class="field-type">${field.type}</span>
            `;
            
            return div;
        }

        function setupDragAndDrop() {
            // Make field items draggable
            document.addEventListener('dragstart', (e) => {
                if (e.target.classList.contains('field-item') || e.target.classList.contains('preview-field')) {
                    e.target.classList.add('dragging');
                    e.dataTransfer.effectAllowed = 'move';
                    e.dataTransfer.setData('text/html', e.target.innerHTML);
                    e.dataTransfer.setData('field', e.target.dataset.field);
                    e.dataTransfer.setData('label', e.target.dataset.label);
                    e.dataTransfer.setData('type', e.target.dataset.type);
                }
            });

            document.addEventListener('dragend', (e) => {
                if (e.target.classList.contains('field-item') || e.target.classList.contains('preview-field')) {
                    e.target.classList.remove('dragging');
                }
            });

            // Setup drop zones (card rows)
            document.querySelectorAll('.card-row').forEach(row => {
                row.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    row.classList.add('drag-over');
                });

                row.addEventListener('dragleave', (e) => {
                    row.classList.remove('drag-over');
                });

                row.addEventListener('drop', (e) => {
                    e.preventDefault();
                    row.classList.remove('drag-over');
                    
                    const field = e.dataTransfer.getData('field');
                    const label = e.dataTransfer.getData('label');
                    const type = e.dataTransfer.getData('type');
                    
                    if (field) {
                        const rowFields = row.querySelector('.row-fields');
                        
                        // Check if field already exists in this row
                        if (!rowFields.querySelector(`[data-field="${field}"]`)) {
                            const fieldEl = document.createElement('div');
                            fieldEl.className = 'preview-field';
                            fieldEl.draggable = true;
                            fieldEl.dataset.field = field;
                            fieldEl.dataset.label = label;
                            fieldEl.dataset.type = type;
                            fieldEl.textContent = label;
                            
                            // Add double-click to remove
                            fieldEl.addEventListener('dblclick', () => {
                                fieldEl.remove();
                            });
                            
                            rowFields.appendChild(fieldEl);
                            updateLivePreview();
                        }
                    }
                });
            });

            // Allow dragging back to available fields
            document.getElementById('availableFields').addEventListener('dragover', (e) => {
                e.preventDefault();
            });

            document.getElementById('availableFields').addEventListener('drop', (e) => {
                e.preventDefault();
                // Remove the field from preview if dragged back
                const dragging = document.querySelector('.dragging');
                if (dragging && dragging.classList.contains('preview-field')) {
                    dragging.remove();
                }
            });
        }

        function updateCardHeader() {
            const headers = {
                account: 'Account Card',
                location: 'Service Location Card',
                workorder: 'Work Order Card'
            };
            document.getElementById('cardHeader').textContent = headers[currentEntity];
        }

        function saveCurrentState() {
            const config = {
                entity: currentEntity,
                context: currentContext,
                rows: {}
            };

            // Save each row's fields
            [1, 2, 3].forEach(rowNum => {
                const rowFields = document.getElementById(`row${rowNum}Fields`);
                config.rows[`row${rowNum}`] = Array.from(rowFields.querySelectorAll('.preview-field')).map(field => ({
                    name: field.dataset.field,
                    label: field.dataset.label,
                    type: field.dataset.type
                }));
            });

            // Store in configurations
            if (!configurations[currentEntity]) {
                configurations[currentEntity] = {};
            }
            configurations[currentEntity][currentContext] = config;
        }

        function loadSavedConfiguration() {
            // Clear current fields
            [1, 2, 3].forEach(rowNum => {
                document.getElementById(`row${rowNum}Fields`).innerHTML = '';
            });

            // Load saved configuration if exists
            if (configurations[currentEntity] && configurations[currentEntity][currentContext]) {
                const config = configurations[currentEntity][currentContext];
                
                Object.keys(config.rows).forEach(rowKey => {
                    const rowNum = rowKey.replace('row', '');
                    const rowFields = document.getElementById(`row${rowNum}Fields`);
                    
                    config.rows[rowKey].forEach(field => {
                        const fieldEl = document.createElement('div');
                        fieldEl.className = 'preview-field';
                        fieldEl.draggable = true;
                        fieldEl.dataset.field = field.name;
                        fieldEl.dataset.label = field.label;
                        fieldEl.dataset.type = field.type;
                        fieldEl.textContent = field.label;
                        
                        fieldEl.addEventListener('dblclick', () => {
                            fieldEl.remove();
                            updateLivePreview();
                        });
                        
                        rowFields.appendChild(fieldEl);
                    });
                });
            }
            updateLivePreview();
        }

        function saveConfiguration() {
            saveCurrentState();
            localStorage.setItem('fieldConfigurations', JSON.stringify(configurations));
            showStatus('Configuration saved successfully!');
        }

        function loadConfigurations() {
            const saved = localStorage.getItem('fieldConfigurations');
            if (saved) {
                configurations = JSON.parse(saved);
            }
        }

        function saveContext() {
            saveCurrentState();
            showStatus('Context saved!');
        }

        function addNewContext() {
            const name = prompt('Enter new context name:');
            if (name) {
                const option = document.createElement('option');
                option.value = name.toLowerCase().replace(/\s+/g, '-');
                option.textContent = name;
                document.getElementById('contextSelect').appendChild(option);
                document.getElementById('contextSelect').value = option.value;
                currentContext = option.value;
                loadSavedConfiguration();
            }
        }

        function resetFields() {
            if (confirm('Reset all fields in current view?')) {
                [1, 2, 3].forEach(rowNum => {
                    document.getElementById(`row${rowNum}Fields`).innerHTML = '';
                });
                updateLivePreview();
                showStatus('Fields reset');
            }
        }

        function updateLivePreview() {
            const previewContainer = document.getElementById('livePreview');
            
            // Check if any fields are configured
            const hasFields = [1, 2, 3].some(rowNum => {
                const fields = document.getElementById(`row${rowNum}Fields`);
                return fields && fields.children.length > 0;
            });

            if (!hasFields) {
                previewContainer.innerHTML = `
                    <div class="empty-preview">
                        <div class="empty-preview-icon">üìã</div>
                        <div>Drag fields to see live preview</div>
                    </div>
                `;
                return;
            }

            // Build live preview card
            let cardHTML = `
                <div class="live-card">
                    <div class="live-card-header">
                        ${currentEntity === 'account' ? 'üë§ Account Details' : 
                          currentEntity === 'location' ? 'üìç Service Location' : 
                          'üîß Work Order'}
                    </div>
                    <div class="live-card-body">
            `;

            // Add each row's fields
            [1, 2, 3].forEach(rowNum => {
                const rowFields = document.getElementById(`row${rowNum}Fields`);
                const fields = Array.from(rowFields.querySelectorAll('.preview-field'));
                
                if (fields.length > 0) {
                    cardHTML += '<div class="live-field-row">';
                    
                    fields.forEach(field => {
                        const fieldName = field.dataset.field;
                        const fieldLabel = field.dataset.label;
                        const fieldType = field.dataset.type;
                        const value = sampleData[currentEntity][fieldName] || 'N/A';
                        
                        cardHTML += `
                            <div class="live-field">
                                <div class="live-field-label">${fieldLabel}</div>
                                <div class="live-field-value ${fieldType}">${value}</div>
                            </div>
                        `;
                    });
                    
                    cardHTML += '</div>';
                }
            });

            cardHTML += `
                    </div>
                </div>
            `;

            previewContainer.innerHTML = cardHTML;
        }

        function showStatus(message) {
            const status = document.getElementById('statusMessage');
            status.textContent = message;
            status.classList.add('show');
            setTimeout(() => {
                status.classList.remove('show');
            }, 3000);
        }

        // Context change handler
        document.getElementById('contextSelect').addEventListener('change', (e) => {
            saveCurrentState();
            currentContext = e.target.value;
            loadSavedConfiguration();
            updateLivePreview();
        });
    </script>
</body>
</html>