erDiagram
    ACCOUNT {
        int AccountID PK "Unique Account/Customer"
        string AccountName "Customer or business name"
        string AccountType "Segmentation/category"
        string BillingStreetAddress "Street for billing"
        string BillingCity
        string BillingState
        string BillingZipCode
        string Status "Current status, e.g. Active, Inactive"
    }

    CONTACT {
        int ContactID PK "Unique identifier for contact"
        int AccountID FK "Account this contact belongs to"
        string FirstName
        string LastName
        string PhoneNumber
        string EmailAddress
        bool IsPrimaryContact "Is this the main contact for account?"
        string CommunicationPreference "e.g., Voice, Text, Email"
    }

    SERVICE_LOCATION {
        int ServiceLocationID PK "Physical place where service is performed"
        int AccountID FK "Linked to customer/account"
        int GeographicAreaID FK "For routing/zoning"
        string LocationName "e.g., Smith Residence, Dock 5"
        string StreetAddress "Line 1"
        string AddressLine2 "Suite/Apt/Unit"
        string City
        string State
        string PostalCode
        string Country
        decimal Latitude "GPS coordinate (WGS84)"
        decimal Longitude "GPS coordinate (WGS84)"
        string AccessInformation "Gate codes, keys, etc."
        string Notes "Special site-specific notes"
    }

    CONTACT_LOCATION {
        int ContactLocationID PK "Unique link between contact and location"
        int ContactID FK "Contact at this location"
        int ServiceLocationID FK "Location for this contact"
        string Role "e.g., Primary, Gatekeeper, Billing"
        string Notes
    }

    DOMAIN {
        int DomainID PK "Unique identifier for industry / asset type"
        string Name "e.g., Boat, Pool, Lawncare"
        string Description "Business/industry context"
    }

    SERVICEABLE_ITEM {
        int ServiceableItemID PK "Asset or thing being serviced"
        int AccountID FK "Who owns/manages this item"
        int PrimaryServiceLocationID FK "Where item is usually located"
        int DomainID FK "Industry-specific domain/type"
        string ItemName "Display name for this item (e.g., Sea Breeze)"
        string ItemType "Subtype: BoatType, PoolType, etc."
        string Identifier1 "e.g., VIN, Hull ID, Serial #, etc."
        string Identifier2 "e.g., Reg number, Asset Tag"
        string Description "Narrative details for field staff"
        string Status "e.g., Active, In Storage, Needs Repair"
    }

    SERVICEABLE_ITEM_PROPERTY {
        int PropertyID PK "Unique row for a property"
        int ServiceableItemID FK "Links to the specific item"
        string PropertyKey "e.g., OverallLength, Heated"
        string PropertyValue "e.g., '32', 'Yes', 'St. Augustine'"
        string ValueType "String, Number, Boolean, etc."
        string Unit "If numeric: ft, gal, sqft, etc."
    }

    SERVICE_ZONE {
        int ServiceZoneID PK "Unique service zone"
        string Name "e.g., Commercial Weekly Pool Customers"
        string Description "Business or operational grouping logic"
        string ZoneType "e.g., Account Type, Service Category"
        bool Active
    }

    SERVICE_LOCATION_SERVICE_ZONE {
        int ServiceLocationServiceZoneID PK
        int ServiceLocationID FK
        int ServiceZoneID FK
    }

    ROUTE_SERVICE_ZONE {
        int RouteServiceZoneID PK
        int RouteID FK
        int ServiceZoneID FK
    }

    GEOGRAPHIC_AREA {
        int GeographicAreaID PK "Unique mapped area"
        string AreaName "E.g., West Tampa Region"
        jsonb area_geometry "GeoJSON polygon for user-drawn region"
        string Notes "Description, rules, or context"
        bool Active "Is active/in use?"
        string DisplayColor "Optional, for visualization"
        timestamp CreatedAt "When area was created"
        timestamp UpdatedAt "Last update"
    }

    SERVICE {
        int ServiceID PK "Definition of a service offered"
        string ServiceName "e.g., Oil Change, Hull Cleaning"
        string Description
        string ServiceCategory "e.g., Pest Control, Lawncare"
        int EstimatedDurationMinutes
        decimal StandardRate
    }

    EMPLOYEE {
        int EmployeeID PK "Unique identifier for worker"
        string FirstName
        string LastName
        string EmployeeType "e.g., Mechanic, Inspector"
        string Email
        string Phone
    }

    SERVICE_AGREEMENT {
        int AgreementID PK
        int AccountID FK
        string Description "e.g., Annual Maintenance Contract"
        date StartDate
        date EndDate
        string Frequency "e.g., Monthly"
        string AgreementStatus "Active, Expired, Cancelled"
    }

    AGREEMENT_ITEM {
        int AgreementItemID PK
        int AgreementID FK
        int ServiceID FK "The specific service included"
        int ServiceLocationID FK "If agreement for a location"
        int ServiceableItemID FK "If agreement for an item"
        decimal Price
        string Notes
    }

    WORK_ORDER {
        int WorkOrderID PK
        int AccountID FK
        int ServiceLocationID FK
        int ServiceableItemID FK "Primary item for WO"
        string WorkOrderType "e.g., Repair, Inspection"
        string WorkOrderStatus "Scheduled, Completed"
        datetime ScheduledDateTime
        datetime CompletionDateTime
        string Priority "High, Medium, Low"
        string Summary "Work summary"
        string Notes_Internal
        string Notes_Customer
    }

    WORK_ORDER_ITEM {
        int WorkOrderItemID PK
        int WorkOrderID FK
        int ServiceID FK "Service/task performed"
        int ServiceableItemID FK
        string Description "Overrides service/service name"
        string Notes "Findings/notes"
        string Resolution "What was done"
        decimal Quantity
        decimal UnitPrice
        decimal LineTotal
        string Status
    }

    WORK_ORDER_ASSIGNMENT {
        int WorkOrderAssignmentID PK
        int WorkOrderID FK
        int EmployeeID FK "Technician assigned"
        datetime AssignedTime
        datetime StartTime
        datetime EndTime
        string AssignmentStatus "Assigned, Completed, etc."
    }

    MATERIAL {
        int MaterialID PK "Parts catalogue"
        string Name "e.g., Oil Filter XYZ"
        string PartNumber
        string Description
        string UnitOfMeasure "Each, Gallon, etc."
        decimal UnitCost
        decimal ListPrice
    }

    MATERIAL_USAGE {
        int MaterialUsageID PK
        int WorkOrderItemID FK "Task using this material"
        int MaterialID FK
        decimal QuantityUsed
        decimal CostAtTimeOfUse
        decimal PriceCharged
        string Notes
    }

    INVOICE {
        int InvoiceID PK
        int AccountID FK
        int WorkOrderID FK
        int ServiceAgreementID FK
        string InvoiceNumber
        date InvoiceDate
        date DueDate
        decimal SubTotal
        decimal TaxAmount
        decimal TotalAmount
        string Status "Draft, Sent, Paid, etc."
        date PaidDate
    }

    INVOICE_LINE_ITEM {
        int LineItemID PK
        int InvoiceID FK
        int WorkOrderItemID FK
        int AgreementItemID FK
        int MaterialUsageID FK
        string Description
        decimal Quantity
        decimal UnitPrice
        decimal LineTotal
        string ItemType "Service, Material, Discount, Fee"
    }

    PAYMENT {
        int PaymentID PK
        int AccountID FK
        int InvoiceID FK
        date PaymentDate
        decimal Amount
        string PaymentMethod "Check, Credit Card, etc."
        string ReferenceNumber "Check #, Transaction ID"
        string Status "Cleared, Pending, Failed"
    }

    CREDIT_MEMO {
        int CreditMemoID PK
        int AccountID FK
        int InvoiceID FK
        string CreditMemoNumber
        date IssueDate
        decimal Amount
        string Reason
        string Status
    }

    COMMUNICATION_LOG {
        int CommunicationLogID PK
        int AccountID FK
        int ContactID FK
        int EmployeeID FK
        int RelatedWorkOrderID FK
        int RelatedInvoiceID FK
        datetime Timestamp
        string Method "Email, Phone, SMS"
        string Subject
        string Body "Content or summary"
        string Direction "Inbound, Outbound"
    }

    ROUTE {
        int RouteID PK
        int EmployeeID FK
        date RouteDate
        string RouteName
        string Status "Planned, Completed, etc."
    }

    ROUTE_STOP {
        int RouteStopID PK
        int RouteID FK
        int WorkOrderAssignmentID FK "Assignment for this stop"
        int ServiceLocationID FK "Stop location"
        int SequenceNumber "Order on route"
        datetime EstimatedArrivalTime
        datetime ActualArrivalTime
        datetime EstimatedDepartureTime
        datetime ActualDepartureTime
        string Status "Pending, Completed, etc."
        string StopNotes
    }

    ACCOUNT ||--o{ CONTACT : "has"
    ACCOUNT ||--o{ SERVICE_LOCATION : "has multiple"
    ACCOUNT ||--o{ SERVICEABLE_ITEM : "owns/manages"
    ACCOUNT ||--o{ SERVICE_AGREEMENT : "has"
    ACCOUNT ||--o{ WORK_ORDER : "requests"
    ACCOUNT ||--o{ INVOICE : "is billed"
    ACCOUNT ||--o{ PAYMENT : "makes"
    ACCOUNT ||--o{ CREDIT_MEMO : "receives"
    ACCOUNT ||--o{ COMMUNICATION_LOG : "logs for"

    CONTACT ||--o{ CONTACT_LOCATION : "linked to location"
    SERVICE_LOCATION ||--o{ CONTACT_LOCATION : "linked to contact"
    CONTACT ||--o{ COMMUNICATION_LOG : "involved in"

    SERVICE_LOCATION ||--o{ SERVICEABLE_ITEM : "can house"
    SERVICE_LOCATION ||--o{ WORK_ORDER : "is site for"
    SERVICE_LOCATION }|--|| GEOGRAPHIC_AREA : "belongs to"
    SERVICE_LOCATION ||--o{ AGREEMENT_ITEM : "for agreement"
    SERVICE_LOCATION ||--o{ ROUTE_STOP : "is a stop at"

    SERVICEABLE_ITEM }|--|| DOMAIN : "has domain"
    SERVICEABLE_ITEM ||--o{ SERVICEABLE_ITEM_PROPERTY : "has property"
    SERVICEABLE_ITEM ||--o{ AGREEMENT_ITEM : "can be subject of"
    SERVICEABLE_ITEM ||--o{ WORK_ORDER : "can be subject of"
    SERVICEABLE_ITEM ||--o{ WORK_ORDER_ITEM : "can be subject of"

    SERVICE_ZONE ||--o{ SERVICE_LOCATION_SERVICE_ZONE : ""
    SERVICE_LOCATION ||--o{ SERVICE_LOCATION_SERVICE_ZONE : ""

    SERVICE_ZONE ||--o{ ROUTE_SERVICE_ZONE : ""
    ROUTE ||--o{ ROUTE_SERVICE_ZONE : ""

    SERVICE_AGREEMENT ||--o{ AGREEMENT_ITEM : "contains"
    SERVICE_AGREEMENT ||--o{ INVOICE : "can generate"
    EMPLOYEE ||--o{ SERVICE_AGREEMENT : "manages/sold"

    SERVICE ||--o{ AGREEMENT_ITEM : "is service in"
    SERVICE ||--o{ WORK_ORDER_ITEM : "is service of"

    WORK_ORDER ||--o{ WORK_ORDER_ITEM : "contains"
    WORK_ORDER ||--o{ WORK_ORDER_ASSIGNMENT : "has"
    WORK_ORDER ||--o{ INVOICE : "can generate"

    EMPLOYEE ||--o{ WORK_ORDER_ASSIGNMENT : "is assigned to"
    EMPLOYEE ||--o{ ROUTE : "is assigned to"
    EMPLOYEE ||--o{ COMMUNICATION_LOG : "handles"

    AGREEMENT_ITEM ||--o{ WORK_ORDER_ITEM : "may be fulfilled by"
    AGREEMENT_ITEM ||--o{ INVOICE_LINE_ITEM : "may be billed by"

    WORK_ORDER_ITEM ||--o{ MATERIAL_USAGE : "uses"
    WORK_ORDER_ITEM ||--o{ INVOICE_LINE_ITEM : "may be billed by"

    MATERIAL ||--o{ MATERIAL_USAGE : "is material for"
    MATERIAL_USAGE ||--o{ INVOICE_LINE_ITEM : "may be billed by"

    INVOICE ||--o{ INVOICE_LINE_ITEM : "contains"
    INVOICE ||--o{ PAYMENT : "is paid by"
    INVOICE ||--o{ CREDIT_MEMO : "is adjusted by"

    ROUTE ||--o{ ROUTE_STOP : "consists of"
    WORK_ORDER_ASSIGNMENT ||--o{ ROUTE_STOP : "is scheduled in"

