<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>1.1.1 Master View - CONCEPT Line</title>
    
    <!-- CONCEPT LINE: Everything inline, no build process needed! -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f5f5f5;
            height: 100vh;
            overflow: hidden;
        }
        
        .header {
            background: white;
            border-bottom: 1px solid #ddd;
            padding: 12px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .header h1 {
            font-size: 20px;
            color: #333;
        }
        
        .hierarchy-badge {
            background: #fef3c7;
            color: #92400e;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .master-view {
            display: flex;
            height: calc(100vh - 57px);
            background: white;
        }
        
        .column {
            flex: 1;
            border-right: 1px solid #e5e5e5;
            display: flex;
            flex-direction: column;
            min-width: 0;
        }
        
        .column:last-child {
            border-right: none;
        }
        
        .column-header {
            background: #f9fafb;
            padding: 12px 16px;
            border-bottom: 1px solid #e5e5e5;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .column-title {
            font-weight: 600;
            font-size: 14px;
            color: #374151;
        }
        
        .column-count {
            background: #e5e7eb;
            color: #6b7280;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 12px;
        }
        
        .search-box {
            padding: 8px 16px;
            border-bottom: 1px solid #e5e5e5;
        }
        
        .search-box input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .column-content {
            flex: 1;
            overflow-y: auto;
            padding: 8px;
        }
        
        .card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.15s;
        }
        
        .card:hover {
            border-color: #3b82f6;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .card.selected {
            background: #eff6ff;
            border-color: #3b82f6;
        }
        
        .card-title {
            font-weight: 600;
            font-size: 14px;
            color: #111827;
            margin-bottom: 4px;
        }
        
        .card-subtitle {
            font-size: 12px;
            color: #6b7280;
            margin-bottom: 8px;
        }
        
        .card-badges {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }
        
        .badge {
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 500;
        }
        
        .badge-commercial {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .badge-residential {
            background: #dcfce7;
            color: #166534;
        }
        
        .badge-industrial {
            background: #fef3c7;
            color: #92400e;
        }
        
        .badge-active {
            background: #dcfce7;
            color: #166534;
        }
        
        .badge-pending {
            background: #fef3c7;
            color: #92400e;
        }
        
        .badge-completed {
            background: #e0e7ff;
            color: #3730a3;
        }
        
        .empty-state {
            padding: 40px 20px;
            text-align: center;
            color: #9ca3af;
            font-size: 14px;
        }
        
        .console-output {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: black;
            color: #0f0;
            padding: 8px 12px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-width: 400px;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .console-output.show {
            opacity: 0.9;
        }
        
        .state-inspector {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #1f2937;
            color: #f3f4f6;
            padding: 12px 20px;
            border-top: 2px solid #374151;
            font-family: 'SF Mono', 'Monaco', 'Courier New', monospace;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 20px;
            z-index: 100;
        }
        
        .state-inspector .label {
            color: #9ca3af;
            margin-right: 6px;
        }
        
        .state-inspector .value {
            color: #10b981;
            font-weight: 600;
        }
        
        .state-inspector .arrow {
            color: #6b7280;
            margin: 0 8px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üêõ Pest Control Master View</h1>
        <div style="display: flex; gap: 10px; align-items: center;">
            <span class="hierarchy-badge">1.1.1 SUB-MODULE</span>
            <span class="hierarchy-badge" style="background: #fef3c7;">CONCEPT LINE</span>
        </div>
    </div>
    
    <div class="master-view">
        <!-- ACCOUNTS COLUMN (1.1.1.1) -->
        <div class="column" id="accounts-column">
            <div class="column-header">
                <span class="column-title">Accounts</span>
                <span class="column-count" id="accounts-count">0</span>
            </div>
            <div class="search-box">
                <input type="text" placeholder="Search accounts..." id="accounts-search">
            </div>
            <div class="column-content" id="accounts-list"></div>
        </div>
        
        <!-- SERVICE LOCATIONS COLUMN (1.1.1.2) -->
        <div class="column" id="locations-column">
            <div class="column-header">
                <span class="column-title">Service Locations</span>
                <span class="column-count" id="locations-count">0</span>
            </div>
            <div class="search-box">
                <input type="text" placeholder="Search locations..." id="locations-search">
            </div>
            <div class="column-content" id="locations-list">
                <div class="empty-state">Select an account to view locations</div>
            </div>
        </div>
        
        <!-- WORK ORDERS COLUMN (1.1.1.3) -->
        <div class="column" id="workorders-column">
            <div class="column-header">
                <span class="column-title">Work Orders</span>
                <span class="column-count" id="workorders-count">0</span>
            </div>
            <div class="search-box">
                <input type="text" placeholder="Search work orders..." id="workorders-search">
            </div>
            <div class="column-content" id="workorders-list">
                <div class="empty-state">Select a location to view work orders</div>
            </div>
        </div>
    </div>
    
    <!-- Console output for concept line -->
    <div id="console" class="console-output"></div>
    
    <!-- State Inspector Panel -->
    <div class="state-inspector">
        <div>
            <span class="label">State:</span>
            <span class="value" id="state-account">No Account</span>
            <span class="arrow">‚Üí</span>
            <span class="value" id="state-location">No Location</span>
            <span class="arrow">‚Üí</span>
            <span class="value" id="state-workorder">No Work Order</span>
        </div>
        <div style="margin-left: auto;">
            <span class="label">Events Fired:</span>
            <span class="value" id="event-count">0</span>
        </div>
    </div>
    
    <!-- SUB-MODULE AWARE FEEDBACK SYSTEM -->
    <!-- <script src="../shared/feedback-framework.js"></script> -->
    <!-- NEW CONTEXTUAL FEEDBACK (Less intrusive) -->
    <script src="../shared/contextual-feedback.js"></script>
    
    <script>
        /**
         * 1.1.1 MASTER VIEW - CONCEPT LINE INTERFACE CONTRACT
         * 
         * PROVIDES:
         * - Events: account:selected, location:selected, workOrder:selected
         * - State: selectedAccount, selectedLocation, selectedWorkOrder
         * - Methods: selectAccount(), selectLocation(), selectWorkOrder()
         * 
         * CONSUMES:
         * - Events: detail-view:closed, workOrder:updated (from other sub-modules)
         * - State: None in concept mode
         * - Methods: None in concept mode
         * 
         * HIERARCHY:
         * 1.1.1 Master View (Sub-Module)
         * ‚îú‚îÄ‚îÄ 1.1.1.1 Accounts Column (Story)
         * ‚îú‚îÄ‚îÄ 1.1.1.2 Service Locations Column (Story)
         * ‚îî‚îÄ‚îÄ 1.1.1.3 Work Orders Column (Story)
         */
        
        // CONCEPT LINE: Everything is simple, console.log everything!
        
        // Mock pest control data - fun names!
        const mockAccounts = [
            { id: 1, name: "BugBusters Inc", type: "Commercial", status: "Active", locations: 3 },
            { id: 2, name: "Ant-Man Solutions", type: "Residential", status: "Active", locations: 5 },
            { id: 3, name: "The Roach Coach", type: "Industrial", status: "Active", locations: 2 },
            { id: 4, name: "Pest Side Story", type: "Commercial", status: "Active", locations: 4 },
            { id: 5, name: "Mosquito Coast Guard", type: "Residential", status: "Active", locations: 1 },
            { id: 6, name: "Flea Market Removal", type: "Commercial", status: "Pending", locations: 3 },
            { id: 7, name: "Spider-Man Services", type: "Residential", status: "Active", locations: 2 },
            { id: 8, name: "Termite Terminators", type: "Industrial", status: "Active", locations: 6 },
            { id: 9, name: "Bee Gone LLC", type: "Commercial", status: "Active", locations: 3 },
            { id: 10, name: "Rat Pack Control", type: "Industrial", status: "Active", locations: 4 }
        ];
        
        const mockLocations = {
            1: [
                { id: 101, accountId: 1, name: "Main Office", address: "123 Bug Ave", nextService: "2025-09-01" },
                { id: 102, accountId: 1, name: "Warehouse", address: "456 Pest St", nextService: "2025-09-15" },
                { id: 103, accountId: 1, name: "Retail Store", address: "789 Insect Blvd", nextService: "2025-09-08" }
            ],
            2: [
                { id: 201, accountId: 2, name: "Home - Kitchen", address: "321 Ant Hill", nextService: "2025-09-02" },
                { id: 202, accountId: 2, name: "Home - Basement", address: "321 Ant Hill", nextService: "2025-09-02" },
                { id: 203, accountId: 2, name: "Home - Attic", address: "321 Ant Hill", nextService: "2025-09-02" },
                { id: 204, accountId: 2, name: "Garage", address: "321 Ant Hill", nextService: "2025-09-10" },
                { id: 205, accountId: 2, name: "Garden Shed", address: "321 Ant Hill", nextService: "2025-09-20" }
            ],
            3: [
                { id: 301, accountId: 3, name: "Factory Floor", address: "999 Industrial Way", nextService: "2025-08-25" },
                { id: 302, accountId: 3, name: "Loading Dock", address: "999 Industrial Way", nextService: "2025-08-28" }
            ],
            4: [
                { id: 401, accountId: 4, name: "Broadway Theater", address: "42 Stage Lane", nextService: "2025-09-05" },
                { id: 402, accountId: 4, name: "Box Office", address: "42 Stage Lane", nextService: "2025-09-05" },
                { id: 403, accountId: 4, name: "Backstage", address: "42 Stage Lane", nextService: "2025-09-12" },
                { id: 404, accountId: 4, name: "Costume Storage", address: "44 Stage Lane", nextService: "2025-09-19" }
            ],
            5: [
                { id: 501, accountId: 5, name: "Beachfront Property", address: "1 Mosquito Beach", nextService: "2025-08-30" }
            ],
            6: [
                { id: 601, accountId: 6, name: "Market Stall A", address: "Flea Market Plaza", nextService: "2025-09-10" },
                { id: 602, accountId: 6, name: "Market Stall B", address: "Flea Market Plaza", nextService: "2025-09-10" },
                { id: 603, accountId: 6, name: "Storage Unit", address: "Flea Market Plaza", nextService: "2025-09-17" }
            ],
            7: [
                { id: 701, accountId: 7, name: "Parker Residence", address: "20 Queens Blvd", nextService: "2025-09-03" },
                { id: 702, accountId: 7, name: "Aunt May's House", address: "22 Queens Blvd", nextService: "2025-09-10" }
            ],
            8: [
                { id: 801, accountId: 8, name: "Wood Processing", address: "100 Timber Road", nextService: "2025-08-28" },
                { id: 802, accountId: 8, name: "Sawmill", address: "100 Timber Road", nextService: "2025-08-28" },
                { id: 803, accountId: 8, name: "Lumber Storage", address: "102 Timber Road", nextService: "2025-09-04" },
                { id: 804, accountId: 8, name: "Office Building", address: "104 Timber Road", nextService: "2025-09-11" },
                { id: 805, accountId: 8, name: "Equipment Shed", address: "106 Timber Road", nextService: "2025-09-11" },
                { id: 806, accountId: 8, name: "Shipping Dock", address: "108 Timber Road", nextService: "2025-09-18" }
            ],
            9: [
                { id: 901, accountId: 9, name: "Hive Removal Site 1", address: "555 Honey Lane", nextService: "2025-09-01" },
                { id: 902, accountId: 9, name: "Hive Removal Site 2", address: "777 Buzz Street", nextService: "2025-09-08" },
                { id: 903, accountId: 9, name: "Equipment Storage", address: "10 Beekeeper Way", nextService: "2025-09-15" }
            ],
            10: [
                { id: 1001, accountId: 10, name: "Sinatra Building", address: "100 Vegas Strip", nextService: "2025-08-29" },
                { id: 1002, accountId: 10, name: "Dean Martin Plaza", address: "200 Vegas Strip", nextService: "2025-09-05" },
                { id: 1003, accountId: 10, name: "Sammy's Corner", address: "300 Vegas Strip", nextService: "2025-09-12" },
                { id: 1004, accountId: 10, name: "The Lounge", address: "400 Vegas Strip", nextService: "2025-09-19" }
            ]
        };
        
        const mockWorkOrders = {
            101: [
                { id: 1001, locationId: 101, title: "Monthly Pest Inspection", status: "Completed", date: "2025-08-01" },
                { id: 1002, locationId: 101, title: "Ant Treatment", status: "Pending", date: "2025-09-01" },
                { id: 1003, locationId: 101, title: "Rodent Control Setup", status: "In Progress", date: "2025-08-20" }
            ],
            102: [
                { id: 1004, locationId: 102, title: "Quarterly Deep Treatment", status: "Pending", date: "2025-09-15" },
                { id: 1005, locationId: 102, title: "Emergency Wasp Removal", status: "Completed", date: "2025-08-10" }
            ],
            201: [
                { id: 2001, locationId: 201, title: "Kitchen Ant Treatment", status: "Pending", date: "2025-09-02" },
                { id: 2002, locationId: 201, title: "Preventive Spray", status: "Completed", date: "2025-08-02" }
            ]
        };
        
        // State management (concept style - just global variables!)
        let selectedAccount = null;
        let selectedLocation = null;
        let selectedWorkOrder = null;
        let eventCount = 0;
        
        // Update state inspector
        function updateStateInspector() {
            document.getElementById('state-account').textContent = selectedAccount?.name || 'No Account';
            document.getElementById('state-location').textContent = selectedLocation?.name || 'No Location';
            document.getElementById('state-workorder').textContent = selectedWorkOrder?.title || 'No Work Order';
            document.getElementById('event-count').textContent = eventCount;
            
            // Save to session storage for demo continuity
            saveStateToSession();
        }
        
        // Session persistence for demos
        function saveStateToSession() {
            const state = {
                selectedAccountId: selectedAccount?.id,
                selectedLocationId: selectedLocation?.id,
                selectedWorkOrderId: selectedWorkOrder?.id,
                eventCount: eventCount
            };
            sessionStorage.setItem('1.1.1-masterViewState', JSON.stringify(state));
            conceptLog('State saved to session', state);
        }
        
        function loadStateFromSession() {
            const saved = sessionStorage.getItem('1.1.1-masterViewState');
            if (saved) {
                const state = JSON.parse(saved);
                conceptLog('Restoring state from session', state);
                
                // Restore selections
                if (state.selectedAccountId) {
                    const account = mockAccounts.find(a => a.id === state.selectedAccountId);
                    if (account) {
                        selectAccount(account);
                        
                        if (state.selectedLocationId) {
                            const location = mockLocations[account.id]?.find(l => l.id === state.selectedLocationId);
                            if (location) {
                                selectLocation(location);
                                
                                if (state.selectedWorkOrderId) {
                                    const workOrder = mockWorkOrders[location.id]?.find(w => w.id === state.selectedWorkOrderId);
                                    if (workOrder) {
                                        selectWorkOrder(workOrder);
                                    }
                                }
                            }
                        }
                    }
                }
                
                eventCount = state.eventCount || 0;
                updateStateInspector();
            }
        }
        
        // Console logger for concept line
        function conceptLog(message, data) {
            console.log(`[1.1.1 Master View] ${message}`, data || '');
            
            // Show in UI console
            const consoleDiv = document.getElementById('console');
            consoleDiv.textContent = `> ${message}`;
            consoleDiv.classList.add('show');
            setTimeout(() => consoleDiv.classList.remove('show'), 2000);
        }
        
        // Render accounts
        function renderAccounts() {
            conceptLog('Rendering accounts', { count: mockAccounts.length });
            
            const container = document.getElementById('accounts-list');
            container.innerHTML = '';
            
            mockAccounts.forEach(account => {
                const card = document.createElement('div');
                card.className = 'card' + (selectedAccount?.id === account.id ? ' selected' : '');
                card.innerHTML = `
                    <div class="card-title">${account.name}</div>
                    <div class="card-subtitle">${account.locations} locations</div>
                    <div class="card-badges">
                        <span class="badge badge-${account.type.toLowerCase()}">${account.type}</span>
                        <span class="badge badge-${account.status.toLowerCase()}">${account.status}</span>
                    </div>
                `;
                
                card.onclick = () => selectAccount(account);
                container.appendChild(card);
            });
            
            document.getElementById('accounts-count').textContent = mockAccounts.length;
        }
        
        // Select account
        function selectAccount(account) {
            conceptLog('Account selected', { id: account.id, name: account.name });
            
            selectedAccount = account;
            selectedLocation = null;
            selectedWorkOrder = null;
            
            // Re-render accounts to show selection
            renderAccounts();
            
            // Load locations for this account
            renderLocations(account.id);
            
            // Clear work orders
            document.getElementById('workorders-list').innerHTML = 
                '<div class="empty-state">Select a location to view work orders</div>';
            document.getElementById('workorders-count').textContent = '0';
            
            // Emit event (concept style)
            window.dispatchEvent(new CustomEvent('account:selected', { 
                detail: { accountId: account.id, accountName: account.name }
            }));
            
            eventCount++;
            updateStateInspector();
        }
        
        // Render locations
        function renderLocations(accountId) {
            const locations = mockLocations[accountId] || [];
            conceptLog('Rendering locations', { accountId, count: locations.length });
            
            const container = document.getElementById('locations-list');
            container.innerHTML = '';
            
            if (locations.length === 0) {
                container.innerHTML = '<div class="empty-state">No locations found</div>';
                document.getElementById('locations-count').textContent = '0';
                return;
            }
            
            locations.forEach(location => {
                const card = document.createElement('div');
                card.className = 'card' + (selectedLocation?.id === location.id ? ' selected' : '');
                card.innerHTML = `
                    <div class="card-title">${location.name}</div>
                    <div class="card-subtitle">${location.address}</div>
                    <div class="card-badges">
                        <span class="badge badge-pending">Next: ${location.nextService}</span>
                    </div>
                `;
                
                card.onclick = () => selectLocation(location);
                container.appendChild(card);
            });
            
            document.getElementById('locations-count').textContent = locations.length;
        }
        
        // Select location
        function selectLocation(location) {
            conceptLog('Location selected', { id: location.id, name: location.name });
            
            selectedLocation = location;
            selectedWorkOrder = null;
            
            // Re-render locations to show selection
            renderLocations(selectedAccount.id);
            
            // Load work orders for this location
            renderWorkOrders(location.id);
            
            // Emit event
            window.dispatchEvent(new CustomEvent('location:selected', { 
                detail: { locationId: location.id, locationName: location.name }
            }));
            
            eventCount++;
            updateStateInspector();
        }
        
        // Render work orders
        function renderWorkOrders(locationId) {
            const workOrders = mockWorkOrders[locationId] || [];
            conceptLog('Rendering work orders', { locationId, count: workOrders.length });
            
            const container = document.getElementById('workorders-list');
            container.innerHTML = '';
            
            if (workOrders.length === 0) {
                container.innerHTML = '<div class="empty-state">No work orders found</div>';
                document.getElementById('workorders-count').textContent = '0';
                return;
            }
            
            workOrders.forEach(order => {
                const card = document.createElement('div');
                card.className = 'card' + (selectedWorkOrder?.id === order.id ? ' selected' : '');
                card.innerHTML = `
                    <div class="card-title">${order.title}</div>
                    <div class="card-subtitle">${order.date}</div>
                    <div class="card-badges">
                        <span class="badge badge-${order.status.toLowerCase().replace(' ', '-')}">${order.status}</span>
                    </div>
                `;
                
                card.onclick = () => selectWorkOrder(order);
                container.appendChild(card);
            });
            
            document.getElementById('workorders-count').textContent = workOrders.length;
        }
        
        // Select work order
        function selectWorkOrder(order) {
            conceptLog('Work order selected', { id: order.id, title: order.title });
            
            selectedWorkOrder = order;
            renderWorkOrders(selectedLocation.id);
            
            // Emit event
            window.dispatchEvent(new CustomEvent('workOrder:selected', { 
                detail: { workOrderId: order.id, title: order.title, status: order.status }
            }));
            
            eventCount++;
            updateStateInspector();
        }
        
        // Search functionality - WORKING in concept!
        document.getElementById('accounts-search').oninput = (e) => {
            const query = e.target.value.toLowerCase();
            conceptLog('Searching accounts', { query: e.target.value });
            
            const container = document.getElementById('accounts-list');
            container.innerHTML = '';
            
            const filtered = mockAccounts.filter(a => 
                a.name.toLowerCase().includes(query) ||
                a.type.toLowerCase().includes(query)
            );
            
            filtered.forEach(account => {
                const card = document.createElement('div');
                card.className = 'card' + (selectedAccount?.id === account.id ? ' selected' : '');
                card.innerHTML = `
                    <div class="card-title">${account.name}</div>
                    <div class="card-subtitle">${account.locations} locations</div>
                    <div class="card-badges">
                        <span class="badge badge-${account.type.toLowerCase()}">${account.type}</span>
                        <span class="badge badge-${account.status.toLowerCase()}">${account.status}</span>
                    </div>
                `;
                card.onclick = () => selectAccount(account);
                container.appendChild(card);
            });
            
            document.getElementById('accounts-count').textContent = filtered.length;
        };
        
        // Initialize on load
        window.onload = () => {
            conceptLog('Master View initialized!', { hierarchy: '1.1.1' });
            renderAccounts();
            
            // Try to restore previous state (for demo continuity)
            loadStateFromSession();
            
            // Listen for events from other sub-modules (concept mode)
            window.addEventListener('detail-view:closed', (e) => {
                conceptLog('Received event from Detail View', e.detail);
                // In concept, just log it
            });
            
            window.addEventListener('workOrder:updated', (e) => {
                conceptLog('Received workOrder:updated event', e.detail);
                eventCount++;
                updateStateInspector();
            });
        };
    </script>
</body>
</html>