# US-006 Task Breakdown - Service Locations Column

**Story**: US-006 View Service Locations for Selected Account  
**Type**: UI Component Story  
**Integration Required**: MANDATORY  
**Generated By**: PLANNER v5.2 Logic  
**Date**: August 14, 2025

---

## ðŸ“Š Story Type Analysis

**Classification**: UI Component Story

- Creates new component: ServiceLocationsList
- User-facing feature in Master View Column 2
- Requires production integration (not test page)
- **MANDATORY INTEGRATION SLICE REQUIRED**

**Complexity**: Medium

- Fetches data from Supabase
- Manages selection state via Context
- Implements pagination
- Handles multiple display states

**Dependencies Verified**:

- âœ… US-005 (Account selection in Column 1) is complete
- âœ… MasterViewContext exists for state management
- âœ… SERVICE_LOCATION entity exists in database

---

## ðŸŽ¯ Value Slice 1: Core Location Display

**Purpose**: Display service locations when account is selected  
**User Value**: Can see all locations for an account  
**ARCHITECT REQUIRED**: YES - New component structure needed

### T-001: Create TypeScript Types and Interfaces

**Size**: Small (30 mins)  
**Dependencies**: BUSM entity definition  
**Files**:

- `src/types/serviceLocation.types.ts`
- `src/types/api/serviceLocationResponse.types.ts`

**Tasks**:

1. Create ServiceLocation interface from BUSM mapping
2. Create ServiceLocationsResponse interface
3. Create PaginationInfo interface
4. Export all types

**Validation**:

- No 'any' types
- All BUSM fields mapped
- Optional fields properly marked

### T-002: Create ServiceLocationsList Component Shell

**Size**: Small (30 mins)  
**Dependencies**: T-001 (types)  
**Files**:

- `src/components/master-view/ServiceLocationsList.tsx`

**Tasks**:

1. Create component with props interface
2. Add loading, error, empty states
3. Set up basic structure
4. Connect to MasterViewContext for selection

**Validation**:

- Component renders without errors
- Props properly typed
- Context connection works

### T-003: Implement Location Data Fetching

**Size**: Medium (1 hour)  
**Dependencies**: T-001, T-002  
**Files**:

- `src/hooks/useServiceLocations.ts`
- `src/lib/supabase/queries/serviceLocations.ts`

**Tasks**:

1. Create useServiceLocations hook
2. Implement Supabase query with pagination
3. Handle loading and error states
4. Filter by account_id and status='Active'

**Validation**:

- Data fetches on accountId change
- Pagination parameters work
- Error handling in place

### T-004: Build Location Card Component

**Size**: Medium (1 hour)  
**Dependencies**: T-001, T-002  
**Files**:

- `src/components/master-view/ServiceLocationCard.tsx`

**Tasks**:

1. Create card layout with location_name prominent
2. Display address (street, city, state, zip)
3. Add PRIMARY badge for is_primary=true
4. Add access info indicator icon
5. Implement selection visual feedback

**Validation**:

- Cards display all required fields
- Selection highlighting works
- PRIMARY badge shows correctly

**Value Slice 1 Acceptance**:

- [ ] Locations display when account selected
- [ ] Cards show correct information
- [ ] Visual design matches specifications

---

## ðŸŽ¯ Value Slice 2: Selection and Pagination

**Purpose**: Enable location selection and handle multiple pages  
**User Value**: Can select locations and navigate pages  
**ARCHITECT REQUIRED**: NO - Extending existing patterns

### T-005: Implement Selection Handling

**Size**: Medium (45 mins)  
**Dependencies**: T-004, Context  
**Files**:

- Update: `src/components/master-view/ServiceLocationsList.tsx`
- Update: `src/context/MasterViewContext.tsx`

**Tasks**:

1. Read selectedLocationId from context
2. Implement onLocationSelect callback
3. Update context on card click
4. Apply visual feedback to selected card
5. Clear selection on account change

**Validation**:

- Selection updates context
- Only one card selected at a time
- Selection clears on account switch

### T-006: Add Pagination Controls

**Size**: Medium (1 hour)  
**Dependencies**: T-003  
**Files**:

- `src/components/master-view/LocationsPagination.tsx`
- Update: `src/components/master-view/ServiceLocationsList.tsx`

**Tasks**:

1. Create pagination component
2. Show "Page X of Y â€¢ Z locations"
3. Implement Previous/Next buttons
4. Handle page state locally
5. Fetch new page on change

**Validation**:

- Page info displays correctly
- Navigation works
- Stays on page 1 when account changes

### T-007: Implement Empty and Error States

**Size**: Small (30 mins)  
**Dependencies**: T-002  
**Files**:

- Update: `src/components/master-view/ServiceLocationsList.tsx`

**Tasks**:

1. Create empty state: "No service locations for this account"
2. Create error state with retry button
3. Add loading skeleton/spinner
4. Handle edge cases gracefully

**Validation**:

- Empty state shows for 0 locations
- Error includes user-friendly message
- Retry button works

**Value Slice 2 Acceptance**:

- [ ] Location selection works
- [ ] Pagination controls function
- [ ] Empty/error states display correctly

---

## ðŸŽ¯ Value Slice 3: API Implementation

**Purpose**: Create backend API for location data  
**User Value**: Real data from database  
**ARCHITECT REQUIRED**: NO - Standard API pattern

### T-008: Create Service Locations API Route

**Size**: Medium (1 hour)  
**Dependencies**: Database, T-001  
**Files**:

- `src/app/api/accounts/[accountId]/service-locations/route.ts`

**Tasks**:

1. Create GET handler
2. Validate accountId parameter
3. Query SERVICE_LOCATION table
4. Implement pagination logic
5. Return formatted response

**Validation**:

- API returns correct data shape
- Pagination works
- Status filtering works
- Error cases handled

### T-009: Add API Error Handling

**Size**: Small (30 mins)  
**Dependencies**: T-008  
**Files**:

- Update: `src/app/api/accounts/[accountId]/service-locations/route.ts`

**Tasks**:

1. Add 404 for invalid account
2. Add 401 for unauthorized
3. Add 500 for server errors
4. Return user-friendly messages
5. Log technical details

**Validation**:

- All error codes implemented
- Messages are user-friendly
- Errors logged properly

**Value Slice 3 Acceptance**:

- [ ] API returns real data
- [ ] Pagination works in API
- [ ] Errors handled gracefully

---

## ðŸš¨ Value Slice 4: Production Integration (MANDATORY)

**Purpose**: Move feature from test to production  
**User Value**: Feature available to real users  
**ARCHITECT REQUIRED**: NO - Integration only

### T-010: Integrate into MasterView Layout

**Size**: Medium (45 mins)  
**Dependencies**: All previous slices complete  
**Files**:

- Update: `src/components/master-view/MasterViewLayout.tsx`
- Update: `src/app/accounts/master/page.tsx`

**Tasks**:

1. Import ServiceLocationsList component
2. Place in Column 2 of layout
3. Wire accountId from Column 1 selection
4. Connect onLocationSelect to context
5. Verify state flow works

**Validation**:

- Component appears in Column 2
- Receives accountId properly
- Selection updates context

### T-011: Update Production Routing

**Size**: Small (30 mins)  
**Dependencies**: T-010  
**Files**:

- Update: `src/app/accounts/master/page.tsx`
- Remove: Any test pages for US-006

**Tasks**:

1. Ensure /accounts/master route works
2. Remove any /test/us-006 pages
3. Update navigation if needed
4. Verify no test artifacts remain

**Validation**:

- Feature at production URL
- No test pages remain
- Navigation works

### T-012: End-to-End Integration Testing

**Size**: Medium (1 hour)  
**Dependencies**: T-010, T-011  
**Files**:

- `cypress/e2e/master-view-locations.cy.ts` (if using Cypress)
- Or manual test checklist

**Tasks**:

1. Test account selection â†’ location display
2. Test location selection â†’ work order update (when US-007 complete)
3. Test pagination flow
4. Test error scenarios
5. Verify all acceptance criteria

**Validation**:

- All acceptance criteria pass
- No console errors
- Performance meets targets

### T-013: Production Smoke Test

**Size**: Small (30 mins)  
**Dependencies**: All tasks complete  
**Files**:

- Production deployment

**Tasks**:

1. Deploy to staging/preview
2. Test core functionality
3. Verify data loads
4. Check responsive behavior
5. Document any issues

**Validation**:

- Works in production environment
- Real data displays correctly
- No regression in Column 1

**Value Slice 4 Acceptance**:

- [ ] Feature live at /accounts/master
- [ ] No test artifacts remain
- [ ] All integration points work
- [ ] Production smoke test passes

---

## ðŸ“ˆ Error Budget Tracking

**Limits Set**:

- Test failures: 0/5 âœ…
- TypeScript errors: 0/3 âœ…
- ESLint warnings: 0/10 âœ…
- Time estimate: 8.5 hours total

**Risk Areas**:

- Pagination performance with 50+ locations
- State synchronization between columns
- Account switching rapid clicks

---

## ðŸŽ¯ Summary

**Total Tasks**: 13  
**Total Estimate**: 8.5 hours  
**Value Slices**: 4 (including MANDATORY integration)  
**Architect Needed**: YES for Value Slice 1

**Delivery Sequence**:

1. Value Slice 1 â†’ Core display working
2. Value Slice 2 â†’ Full interaction
3. Value Slice 3 â†’ Real data
4. Value Slice 4 â†’ In production!

**Critical Success Factor**: Value Slice 4 MUST be completed or the feature has ZERO user value!

---

## ðŸš€ Next Steps

1. âœ… Task breakdown complete
2. â†’ Run ARCHITECT for Value Slice 1
3. â†’ Run PROCESSOR-SELECTOR after architecture
4. â†’ Execute processors in sequence
5. â†’ Manual implementation
6. â†’ MANDATORY integration
7. â†’ Deploy to production

---

_Generated following PLANNER v5.2 specifications with mandatory integration requirements_
